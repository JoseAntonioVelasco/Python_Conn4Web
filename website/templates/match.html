{% extends "base.html" %}
{% block links %}
<link rel="stylesheet" href="{{ url_for('static', filename='styTab.css') }}">
{% endblock %}
{% block title %}Crear Partida{% endblock %}

{% block content %}
<h1 align="center">Match id: {{match.id}}</h1>
<div id="game-board">
    <div class="column" id="column-0" data-x="0">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
    <div class="column"  id="column-1" data-x="1">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
    <div class="column" id="column-2" data-x="2">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
    <div class="column" id="column-3" data-x="3">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
    <div class="column" id="column-4" data-x="4">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
    <div class="column" id="column-5" data-x="5">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
    <div class="column" id="column-6" data-x="6">
        <svg height="100" width="100" class="row-5">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-4">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-3">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-2">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-1">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
        <svg height="100" width="100" class="row-0">
          <circle cx="50" cy="50" r="40" stroke="#0B4E72" stroke-width="3" class="free" />
        </svg> 
    </div>
</div>
<textarea id="chat" cols="70" rows="10" placeholder="No hay mensajes todavia."></textarea><br><br>
<form action="">
  <input type="text" id="text" size="60" placeholder="Escribe tu mensaje aqui"/>
  <button type="button" id="send" class="btn btn-success">ENVIAR</button>
</form>

{% endblock %}

{% block scripts %}
<script
  type="text/javascript"
  src="{{ url_for('static', filename='con4.js') }}"
></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
<script>
  var socket = io.connect()

  // broadcast a message to backend
  socket.on('connect', function() {
    console.log('ha entrado en connect')
    socket.emit('join', {})
  })

  $("#send").click(function(e){
    console.log('ha entrado en send')
    texto = $('#text').val()
    $('#text').val('')
    socket.emit('text', {msg: texto})
  })

	var columns = document.querySelectorAll('.column');
	Array.prototype.forEach.call(columns, function(col) {
		col.addEventListener('click', function() {
      console.log('ha hecho click en una columna')
			var flag = markNextFree(col.getAttribute('data-x'));
			if(flag[0]){
        console.log('ha hecho click en una columna y manda emit')
        x = flag[1]
        y = flag[2]
        color = flag[3]
        socket.emit('place', {x: x, y: y, color: color})
			}
		});
	});
  

  // message from backend to frontend
  socket.on('status', function(data){
    console.log('ha entrado en status')
    //ha entrado al chat
    $('#chat').val($('#chat').val() + '<' + data.msg + '>\n');
    $('#chat').scrollTop($('#chat')[0].scrollHeight);

    //cargar partida
    console.log(data.board)
    loadBoard(data.board)
    
    if(playerColor == "None"){
      playerColor = data.color
    }
  })

  socket.on('message', function(data){
    console.log('ha entrado en message')
    $('#chat').val($('#chat').val() + data.msg + '\n');
    $('#chat').scrollTop($('#chat')[0].scrollHeight);
  })
  
  socket.on('place', function(data){
    console.log('ha entrado en place')
    document.querySelector('#column-'+data.x+' .row-'+data.y+' circle').setAttribute(
					'class', data.color
    );
    gameBoard[data.y][data.x] = playerColor;
  })

</script>
{% endblock %}